#cloud-config
# vim: syntax=yaml
#
###=============================================================================###
# Bootstrap setup for a Linux server
# 
# cloud-init docs:
#   https://cloudinit.readthedocs.io/en/latest/index.html 
# 
# Examples:
#   https://cloudinit.readthedocs.io/en/latest/topics/examples.html
#
###=============================================================================###

# Upgrade the instance on first boot
# (ie run apt-get upgrade)
package_upgrade: true

# Install additional packages on first boot
packages:
  # DPDK Dependencies
  - librdmacm-dev
  - librdmacm1
  - libnuma-dev
  - libmnl-dev
  - libpcap-dev
  - autoconf 
  - lib32z1
  - meson
  - pkg-config
  - cmake
  - python3-pyelftools
  - python-pyelftools
  - python3-pip
  # Useful stuff you need
  - libtool
  - screen
  - build-essential
  - git
  - tree
  - dstat
  - slurm
  - psmisc
  - net-tools
  - nfs-common
  - sysstat
  - dnsutils
  - numactl
  - apt-file
  # Need these to support apt over http
  - apt-transport-https
  - ca-certificates
  - curl
  - gnupg-agent
  - software-properties-common

# Run commands once on first boot - clone and compile useful tools
runcmd:
  # Needed for DPDK
  - [pip3, install, ninja]
  - [pip3, install, meson]
  # Compile/install iperf3
  - [git, clone, https://github.com/esnet/iperf.git]
  - [cd, iperf]
  - ['./configure']
  - [make]
  - [make, install]
  - [/usr/sbin/ldconfig]
  - [cd, ~]
  # Compile/install sockperf
  - [git, clone, https://github.com/mellanox/sockperf]
  - [cd, sockperf]
  - ['./autogen.sh']
  - ['./configure']
  - [make]
  - [make, install]
  - [cd, ~]
  # Compile/install FIO
  - [git, clone, https://github.com/axboe/fio.git]
  - [cd, fio]
  - ['./configure']
  - [make]
  - [make, install]
  - [cd, ~]
  # System cleanup
  - [apt-get, clean, -yy]
  - [apt-get, autoremove, -yy]
  - [mandb, -c]
  - [apt-file, update]

###--- Users
# Add myself
users:
  # Keep the original default user
  - name: default
  # Start adding additional users - my laptop and Ansible server
  - name: labuser
    ssh-authorized-keys:
    - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDJGwCSVGbI9r2GlR//qmtomVOh50Il6IVAomSLMEld9K0Dpi4Lfh3C44/Mn/Cm/QA5dMbHh5avfUCWiGMVEe8CMotD12/I/8xXHv+XoJdjqlcDyUILnOjs46FmEvQyfvzBlEuYeVDNt1VYc2Os+N+LnkiJYlNaxVnS07rOkDV3maNCDjJfMFF8a2EBXwHZkS/quqczMtsItZkrRkLrJJEmNWZwxfzBa2fp21t2dAIxNPdSh7WKG9FKpiLEfpSgjlXK6U5Kv+gZCAEARkRDkCehpa4Sf+SpvzWZ3Mo18H91YFpzU0kHc+Fv3t+mBMFtultbZk6LEbFycTlRDAXI0HRT amr\ksvietme@ksvietme-mobl
    - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDmXVw66eQL3tV8fII8sCF+Jfs+LmQp1Gy2VXXaCLsQBHjHITPt1ffED3GWVIO0uNAvYpDhFJsE7gVwGvAhzeNhnIvtn1/Lyb4y1N5uQy1W9pRhV7EbtjgvYG8BAzcjRMmqRWnx/W+uUpzBIWxObJETIo8dW/obYvjZVVKc1HgMjo061P4iZ6PTYoto1M1qlgIXjSJ5BMUMjB0Pg8JnYvKP6ajC6BJNrM5mmkSPxJtQI/jlZMWxeEnG4YK30eXLfjooxPaIwazJVPFg1C/QNdK0Ejq+83dzXDVyXx+mhaImPI2F5fy056AW4F4R07h7J1KKEZR4s5weQOWSvDQZqqelcJk+qtBrtdvYVz0sc5TYtvJyU1ZI5HUKg86zMcRj960qMzoTE10QkYrHtm80wPnjc2UUmDY2r8GPAnLc9e6tkgfdgoT3svX+ZrAviOdBSOkc/PoSqAvLGqhm8Fs/iaZePChaOX9mu/1WG1HvLgv/430PojBfCduRX2KuTdegVQ0= ksvietme@ksvietme-mobl
    - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCrJyUa7nl2DTMTqx1uZIdYaoS03Yn7oJyXunXrC4PX/3PRuQbk9BVyDCKF9f5TgM6aeVljWJGLXm4l/4ZJfIOCjuz2r1FNVXkbFlPxdKecInF9lzzNc63bS8sFs3zpb4O8t95BM+fKVAm+ivUM7SEG9hBPigGs3fAeQMkVMARJ+GV2zLMTlsfI2V9xDPnP1LxOgqTogg3gbdEpCqKE2/mdQ9ThwNDI4l8tskYSIY5jtIJfuS85usCisf5Ies9fTkDJ11WqlkUfOfvxUmN4wBDVacbpGpk6qg/VEVksugAtAMAE/KCSUr1Ny1yIJ1eXFfzCpuYWRtBhEZfUcPNjxXsiSwnYVpx9uRdEzwzdK7pJLmiZJRDHp2YKIzACqZMDeFYXrD/SvtXL68ftc7Mw8nlp7I2mp0uhg/F/3gKHb+wf/QOind9wxUH/K6ryRdpGMInS5gYM4G96m5yS0XI9GFmNQb08sj99sH417xxuCGlMZb5UBDCls/T7QlJwF09wm80= azureuser@linuxtools
    - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDAwkpEft8CfBNpX/i6B8QZvqbDY2WboNzGM6LdsYZ5oO+a8LpP8hP1x1gVOGIJLX3HZlcpru/qZRzuXlUpgZNLvBUqPNZkXxbd8v5fvhiVp2M0/tHGBoVT4CNVApeh5oau239hi7g/x53k8aVQCSYFbWXeP55Olq98TUcqtdVr6CaIqKfrKprxJKlAsrTAGjYrEHFJtZ/w6CFyOvKWXvq4eiQUAFmsgonX7HcNu7S+4M1Snn4ButaDthO7gNZUZaNVR6WukYMWFRewPSXq1M/mMmuP/+pk1mBma6wHLUZKEE9Y61p2qUEGgfgCm91zMpcboTU51TgptDp91tD9T/8HETBiOO5GKE8w17trrjgStiscBffzkvQDQaWeAbuUImFM+tqcrdbdsG4a7ILwO6x+10PLBuWMP2CuIVKQjHezgACsaBw0VHdo9tB8hDLcIy3y4vHCXfQkCJriu7JICGgY7feDWutfAkYpsdmdJhCcV13XFganKdnoua7duYQh5Cc= root@linuxtools
    sudo: ['ALL=(ALL) NOPASSWD:ALL']
    groups: sudo
    shell: /bin/bash


###--- Misc system configuration
timezone: "America/Los_Angeles"

# Create empty files on the system
write_files:
- path: /root/CONFIGURED_BY_CLOUD_INIT



###--- End File